import{_ as O,u as ae,a as oe,B as F,I as ne}from"./index-dpw65rou.js";import{c as se}from"./useAutoReveal-D346XYK5.js";import{c as q,b as re,M as ie,D as ce}from"./ManagerLayout-BvWGsa5U.js";import{ad as ue,j as J,r as M,c as T,e as V,d as de,n as G,k as N,t as R,l as I,B as ve,C as w,u as i,J as C,A as he,H,I as U,a4 as fe,F as pe}from"./vue-vendor-Tej308t_.js";import{V as ge,W as xe,X as me,Y as Ce,P as $,Z as _e}from"./element-plus-7YpE0pad.js";import"./icons-B-GXtYFD.js";const E=ue("letter",{state:()=>({contexts:{},isPaused:!1,isAutoRevealing:!1}),actions:{getContext(l){return l&&this.contexts[l]||null},setContext(l,o){this.contexts[l]=o},setCharsPerRow(l,o){this.contexts[l]&&(this.contexts[l].charsPerRow=o)},hasContext(l){return!!this.contexts[l]},setAutoRevealing(l){this.isAutoRevealing=l},setPaused(l){this.isPaused=l},revealChar(l,o){const e=this.getContext(l);e&&!e.revealed.includes(o)&&e.revealed.push(o)},revealAll(l){const o=this.getContext(l);o&&(o.revealed=Array.from({length:o.totalChars},(e,r)=>r))},coverAll(l){const o=this.getContext(l);o&&(o.revealed=[])},generateOrder(l,o){const e=this.getContext(l);if(!e)return;const r=Array.from({length:e.totalChars},(t,n)=>n);switch(o){case"random":for(let t=r.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[r[t],r[n]]=[r[n],r[t]]}break;case"sequential":break;case"reverse":r.reverse();break}e.order=r}}});function W(l,o){return l.revealed.includes(o)}function Re(l,o){const e=l.id,t=E().getContext(e);t&&(W(l,o)?t.revealed=l.revealed.filter(n=>n!==o):t.revealed.push(o))}function be(l,o,e,r){if(!l.value||!o.value||!o.value.content)return;const t=l.value.getContext("2d");if(!t)return;const n=o.value,{content:b,charsPerRow:f}=n;t.clearRect(0,0,e,r);const d=b.split(""),x=d.length,A=Math.ceil(x/f),u=e/f,_=r/A,k=Math.min(u,_)*.8;t.font=`${k}px "Noto Sans TC", "Microsoft JhengHei", sans-serif`,t.textAlign="center",t.textBaseline="middle",d.forEach((g,v)=>{const P=Math.floor(v/f),m=v%f,h=m*u+u/2,s=P*_+_/2;if(W(n,v))t.fillStyle="#ffffff",t.fillText(g,h,s);else{t.fillStyle="rgba(255, 255, 255, 0.1)",t.fillRect(m*u+5,P*_+5,u-10,_-10),t.fillStyle="rgba(255, 255, 255, 0.3)";const S=t.font;t.font=`${k*.5}px "Noto Sans TC", "Microsoft JhengHei", sans-serif`,t.fillText((v+1).toString(),h,s),t.font=S}}),t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=1;for(let g=0;g<=f;g++){const v=g*u;t.beginPath(),t.moveTo(v,0),t.lineTo(v,r),t.stroke()}for(let g=0;g<=A;g++){const v=g*_;t.beginPath(),t.moveTo(0,v),t.lineTo(e,v),t.stroke()}}function Ae(l,o,e,r,t){if(!o.value||!e.value)return;const n=e.value,{content:b,charsPerRow:f}=n,d=o.value.getBoundingClientRect(),x=l.clientX-d.left,A=l.clientY-d.top,u=b.length,_=Math.ceil(u/f),k=r/f,g=t/_,v=Math.floor(x/k),m=Math.floor(A/g)*f+v;m>=0&&m<u&&Re(n,m)}const{startReveal:Pe,stopReveal:we,pauseReveal:ye,resumeReveal:Me,revealAll:Se,coverAll:ke}=se({useStore:()=>{const l=E();return{...l,addRevealed:(o,e)=>l.revealChar(o,e)}},setRevealingMethod:"setAutoRevealing",addRevealedMethod:"revealChar"}),Te={class:"display-root"},Ve=["width","height"],Le=J({__name:"Letter",props:{id:{default:null},isManualMode:{type:Boolean,default:!0}},setup(l,{expose:o}){const e=l,r=q(),t=E(),n=M(null),b=M(null),f=M(800),d=M(600),x=T(()=>{if(!e.id)return{};const s=r.getData(e.id),S=t.getContext(e.id);return{...s,...S}}),A=()=>{if(!n.value)return;const s=n.value.getBoundingClientRect();f.value=s.width,d.value=s.height},u=()=>{be(b,x,f.value,d.value)},_=s=>{!b.value||!x.value||t.isAutoRevealing||!e.isManualMode||(Ae(s,b,x,f.value,d.value),u())};return o({startAutoReveal:()=>{if(!e.id)return!1;const s=t.getContext(e.id);if(!s||s.revealed.length>=s.totalChars)return!1;const S=s.charsPerSecond||5,B=Math.round(1e3/S);return Pe({id:e.id,duration:B,onReveal:()=>{u()}}),!0},pauseAutoReveal:()=>(ye(),!0),resumeAutoReveal:()=>(Me(),!0),stopAutoReveal:()=>(we(),!0),revealAllLetters:()=>e.id?Se(e.id,()=>{u()}):!1,coverAllLetters:()=>e.id?ke(e.id,()=>{u()}):!1}),V(()=>e.id,s=>{s&&G(()=>{A(),u()})},{immediate:!0}),V(()=>{var s;return(s=x.value)==null?void 0:s.revealed},()=>{u()},{deep:!0}),V(()=>{var s;return(s=x.value)==null?void 0:s.charsPerRow},()=>{u()}),de(()=>{A(),u(),window.addEventListener("resize",()=>{A(),G(()=>{u()})})}),(s,S)=>(I(),N("div",Te,[R("div",{class:"display-canvas-container",ref_key:"canvasContainer",ref:n},[R("canvas",{ref_key:"letterCanvas",ref:b,class:"letterCanvas",width:f.value,height:d.value,style:{position:"absolute",cursor:"pointer"},onClick:_},null,8,Ve)],512)]))}}),Be=O(Le,[["__scopeId","data-v-dce48ce5"]]),De={class:"top-bar-section common-utils"},Fe={class:"chars-per-row-control"},Ie={class:"top-bar-section auto-play"},Ee={class:"duration-control"},Ne={style:{display:"flex","align-items":"center"}},ze={class:"top-bar-section mode-toggle"},Ge={key:0,class:"floating-play-button"},He=J({__name:"LetterManager",setup(l){const o=q(),e=E(),{t:r}=ae(),{fileInput:t,currentId:n,canGoPrev:b,canGoNext:f,isAutoRevealing:d,isPaused:x,triggerFileInput:A,onFileChange:u,handleDataSelect:_,goToPrev:k,goToNext:g}=re({dataStore:o,extraStore:e,dataType:"text",fileAccept:".txt",loadFile:async a=>{const{loadTextFile:c}=await oe(async()=>{const{loadTextFile:y}=await import("./useTextLoader-CJ0AQ3WN.js");return{loadTextFile:y}},[]);return await c(a)},onFileAdded:(a,c)=>{if(c==="added"){const y=o.getData(a);y&&e.setContext(a,{totalChars:y.content.length,charsPerRow:P.value,revealed:[],isManual:h.value,autoRevealMode:s.value,charsPerSecond:m.value})}}}),v=M(null),P=M(10),m=M(5),h=M(!0),s=M("random"),S=T(()=>{const a=e.getContext(n.value);return a?a.totalChars>a.revealed.length&&a.revealed.length>0:!1}),B=T(()=>{const a=e.getContext(n.value);return a&&a.revealed.length<a.totalChars}),j=T(()=>{const a=e.getContext(n.value);return a?a.revealed.length>0:!1}),D=T({get:()=>m.value,set:a=>{m.value=a;const c=e.getContext(n.value);c&&e.setContext(n.value,{...c,charsPerSecond:m.value})}}),X=[{value:"random",icon:"PhShuffleSimple",label:r("letter.random")},{value:"sequential",icon:"PhArrowRight",label:r("letter.sequential")},{value:"reverse",icon:"PhArrowLeft",label:r("letter.reverse")}],z=T(()=>({icon:h.value?"PhCursorClick":"PhClockClockwise",tooltip:h.value?r("letter.switchToAuto"):r("letter.switchToManual")})),Y=()=>{var a,c,y;if(d.value)x.value?(c=v.value)==null||c.resumeAutoReveal():(y=v.value)==null||y.pauseAutoReveal();else{if(n.value){const L=e.getContext(n.value);L&&e.setContext(n.value,{...L,autoRevealMode:s.value})}(a=v.value)==null||a.startAutoReveal()}},Z=()=>{var a;(a=v.value)==null||a.revealAllLetters()},K=()=>{var a;(a=v.value)==null||a.coverAllLetters()},Q=()=>{h.value=!h.value;const a=e.getContext(n.value);a&&e.setContext(n.value,{...a,isManual:h.value})};return V(P,a=>{n.value&&e.setCharsPerRow(n.value,a)}),V(n,a=>{const c=e.getContext(a);c&&(m.value=c.charsPerSecond||5,h.value=c.isManual,P.value=c.charsPerRow,s.value=c.autoRevealMode)}),V(s,()=>{const a=e.getContext(n.value);a&&e.setContext(n.value,{...a,autoRevealMode:s.value})}),(a,c)=>{const y=Ce,L=xe,ee=ge,te=_e,le=me;return I(),ve(ie,{"can-go-prev":i(b),"can-go-next":i(f),disabled:i(d),onGoPrev:i(k),onGoNext:i(g)},{"file-input":w(()=>[R("input",{ref_key:"fileInput",ref:t,type:"file",accept:".txt",onChange:c[0]||(c[0]=(...p)=>i(u)&&i(u)(...p)),style:{display:"none"}},null,544)]),"common-utils":w(()=>[R("div",De,[C(y,null,{default:w(()=>[C(F,{onClick:K,icon:"PhEyeClosed",title:i(r)("topbar.hideAll"),disabled:!j.value},null,8,["title","disabled"]),C(F,{onClick:Z,icon:"PhFrameCorners",title:i(r)("topbar.showAll"),disabled:!B.value},null,8,["title","disabled"])]),_:1}),R("div",Fe,[R("span",null,$(i(r)("letter.charsPerRow"))+":",1),C(L,{modelValue:P.value,"onUpdate:modelValue":c[1]||(c[1]=p=>P.value=p),min:1,max:100,step:1,size:"small",disabled:i(d)},null,8,["modelValue","disabled"])])])]),"auto-play-controls":w(()=>[R("div",Ie,[H(R("div",Ee,[C(ee,{modelValue:D.value,"onUpdate:modelValue":c[2]||(c[2]=p=>D.value=p),min:1,max:100,step:1,style:{width:"120px"},disabled:h.value||i(d),"show-tooltip":!1},null,8,["modelValue","disabled"]),C(L,{modelValue:D.value,"onUpdate:modelValue":c[3]||(c[3]=p=>D.value=p),min:1,max:100,step:1,size:"small",disabled:h.value||i(d),style:{width:"100px"}},null,8,["modelValue","disabled"])],512),[[U,!h.value]]),H(C(le,{class:"text-select",modelValue:s.value,"onUpdate:modelValue":c[4]||(c[4]=p=>s.value=p),size:"small",disabled:i(d)||h.value},{default:w(()=>[(I(),N(pe,null,fe(X,p=>C(te,{key:p.value,label:p.label,value:p.value},{default:w(()=>[R("div",Ne,[C(ne,{name:p.icon,style:{"margin-right":"5px"}},null,8,["name"]),R("span",null,$(p.label),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue","disabled"]),[[U,!h.value]])])]),"mode-toggle":w(()=>[R("div",ze,[C(F,{icon:z.value.icon,title:z.value.tooltip,tooltipPlacement:"left",onClick:Q,disabled:i(d)||S.value},null,8,["icon","title","disabled"])])]),display:w(()=>[C(Be,{ref_key:"letter",ref:v,id:i(n),isManualMode:h.value},null,8,["id","isManualMode"])]),"floating-button":w(()=>[h.value?he("",!0):(I(),N("div",Ge,[C(F,{onClick:Y,icon:i(d)&&!i(x)?"PhPause":"PhPlay",title:i(d)&&!i(x)?i(r)("topbar.pause"):i(r)("topbar.play"),"icon-size":28,disabled:!B.value,size:"large",circle:""},null,8,["icon","title","disabled"])]))]),sidebar:w(()=>[C(ce,{"current-id":i(n),"data-store":i(o),"extra-store":i(e),"data-type":"text",onSelectData:i(_),onAddFile:i(A)},null,8,["current-id","data-store","extra-store","onSelectData","onAddFile"])]),_:1},8,["can-go-prev","can-go-next","disabled","onGoPrev","onGoNext"])}}}),je=O(He,[["__scopeId","data-v-ba6585e1"]]);export{je as default};
