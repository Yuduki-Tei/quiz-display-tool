{"version":3,"file":"useTextLoader-CJ0AQ3WN.js","sources":["../../src/composables/useTextLoader.ts"],"sourcesContent":["import type { TextData } from \"@/@types/types\";\n\n/**\n * Generate SHA-256 hash from file for unique ID\n * @param file - The file to hash\n * @returns Promise<string> - The hash as hex string\n */\nasync function getSha256(file: File): Promise<string> {\n  const buffer = await file.arrayBuffer();\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  const hashHex = hashArray\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n  return hashHex;\n}\n\n/**\n * Generate a name for text data (first 2 words if starts with English letter, otherwise first 5 characters)\n * @param content - The full text content\n * @returns string - The name text with \"...\" suffix if truncated\n */\nexport function getTextName(content: string): string {\n  if (!content) return \"\";\n\n  // Remove leading/trailing whitespace and newlines\n  const trimmed = content.trim().replace(/\\s+/g, \" \");\n\n  // Check if first character is an English letter (a-z, A-Z)\n  const firstChar = trimmed.charAt(0);\n  const isEnglishLetter = /[a-zA-Z]/.test(firstChar);\n\n  if (isEnglishLetter) {\n    // For English: take first 2 words\n    const words = trimmed.split(\" \");\n    if (words.length <= 2) {\n      return trimmed;\n    }\n    return words.slice(0, 2).join(\" \") + \"...\";\n  } else {\n    // For everything else (CJK, numbers, symbols, etc.): take first 5 characters\n    return trimmed.length > 5 ? trimmed.slice(0, 5) + \"...\" : trimmed;\n  }\n}\n\n/**\n * Generate a preview text for thumbnail display (always 1 character)\n * @param content - The full text content\n * @returns string - The first character of the content\n */\nexport function getTextPreview(content: string): string {\n  if (!content) return \"\";\n  const trimmed = content.trim().replace(/\\s+/g, \" \");\n  return trimmed.charAt(0);\n}\n\n/**\n * Load a text file and return an array of TextData (one per line)\n * @param file - The text file to load\n * @returns Promise<TextData[]> - Array of text data, one for each non-empty line\n */\nexport async function loadTextFile(file: File): Promise<TextData[]> {\n  // Quick validation before any heavy operations\n  const maxSize = 1 * 1024 * 1024;\n  if (file.size > maxSize) {\n    throw new Error(\"File too large\");\n  }\n\n  if (file.size === 0) {\n    throw new Error(\"Empty file\");\n  }\n\n  const baseId = await getSha256(file);\n  const content = await file.text();\n\n  const lines = content.split(\"\\n\").filter((line) => line.trim() !== \"\");\n  if (lines.length === 0) {\n    throw new Error(\"No content\");\n  }\n\n  // Limit number of lines to prevent UI freeze\n  const maxLines = 100;\n  if (lines.length > maxLines) {\n    throw new Error(\"Too many lines\");\n  }\n\n  return lines.map((line, index) => {\n    const trimmedContent = line.trim();\n    return {\n      id: `${baseId}-${index}`,\n      name: getTextName(trimmedContent),\n      content: trimmedContent,\n      thumbnailSrc: getTextPreview(trimmedContent),\n    };\n  });\n}\n"],"names":["getSha256","file","buffer","hashBuffer","b","getTextName","content","trimmed","firstChar","words","getTextPreview","loadTextFile","baseId","lines","line","index","trimmedContent"],"mappings":"AAOA,eAAeA,EAAUC,EAA6B,CACpD,MAAMC,EAAS,MAAMD,EAAK,YAAA,EACpBE,EAAa,MAAM,OAAO,OAAO,OAAO,UAAWD,CAAM,EAK/D,OAJkB,MAAM,KAAK,IAAI,WAAWC,CAAU,CAAC,EAEpD,IAAKC,GAAMA,EAAE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,EAC1C,KAAK,EAAE,CAEZ,CAOO,SAASC,EAAYC,EAAyB,CACnD,GAAI,CAACA,EAAS,MAAO,GAGrB,MAAMC,EAAUD,EAAQ,KAAA,EAAO,QAAQ,OAAQ,GAAG,EAG5CE,EAAYD,EAAQ,OAAO,CAAC,EAGlC,GAFwB,WAAW,KAAKC,CAAS,EAE5B,CAEnB,MAAMC,EAAQF,EAAQ,MAAM,GAAG,EAC/B,OAAIE,EAAM,QAAU,EACXF,EAEFE,EAAM,MAAM,EAAG,CAAC,EAAE,KAAK,GAAG,EAAI,KAAA,KAGrC,QAAOF,EAAQ,OAAS,EAAIA,EAAQ,MAAM,EAAG,CAAC,EAAI,MAAQA,CAE9D,CAOO,SAASG,EAAeJ,EAAyB,CACtD,OAAKA,EACWA,EAAQ,KAAA,EAAO,QAAQ,OAAQ,GAAG,EACnC,OAAO,CAAC,EAFF,EAGvB,CAOA,eAAsBK,EAAaV,EAAiC,CAGlE,GAAIA,EAAK,KAAO,QACd,MAAM,IAAI,MAAM,gBAAgB,EAGlC,GAAIA,EAAK,OAAS,EAChB,MAAM,IAAI,MAAM,YAAY,EAG9B,MAAMW,EAAS,MAAMZ,EAAUC,CAAI,EAG7BY,GAFU,MAAMZ,EAAK,KAAA,GAEL,MAAM;AAAA,CAAI,EAAE,OAAQa,GAASA,EAAK,KAAA,IAAW,EAAE,EACrE,GAAID,EAAM,SAAW,EACnB,MAAM,IAAI,MAAM,YAAY,EAK9B,GAAIA,EAAM,OADO,IAEf,MAAM,IAAI,MAAM,gBAAgB,EAGlC,OAAOA,EAAM,IAAI,CAACC,EAAMC,IAAU,CAChC,MAAMC,EAAiBF,EAAK,KAAA,EAC5B,MAAO,CACL,GAAI,GAAGF,CAAM,IAAIG,CAAK,GACtB,KAAMV,EAAYW,CAAc,EAChC,QAASA,EACT,aAAcN,EAAeM,CAAc,CAAA,CAC7C,CACD,CACH"}