{"version":3,"file":"useTextLoader-DnyA7q0G.js","sources":["../../src/composables/useTextLoader.ts"],"sourcesContent":["import type { TextData } from \"@/@types/types\";\n\n/**\n * Generate SHA-256 hash from file for unique ID\n * @param file - The file to hash\n * @returns Promise<string> - The hash as hex string\n */\nasync function getSha256(file: File): Promise<string> {\n  const buffer = await file.arrayBuffer();\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  const hashHex = hashArray\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n  return hashHex;\n}\n\n/**\n * Generate a name for text data (first 2 words if starts with English letter, otherwise first 5 characters)\n * @param content - The full text content\n * @returns string - The name text with \"...\" suffix if truncated\n */\nexport function getTextName(content: string): string {\n  if (!content) return \"\";\n\n  // Remove leading/trailing whitespace and newlines\n  const trimmed = content.trim().replace(/\\s+/g, \" \");\n\n  // Check if first character is an English letter (a-z, A-Z)\n  const firstChar = trimmed.charAt(0);\n  const isEnglishLetter = /[a-zA-Z]/.test(firstChar);\n\n  if (isEnglishLetter) {\n    // For English: take first 2 words\n    const words = trimmed.split(\" \");\n    if (words.length <= 2) {\n      return trimmed;\n    }\n    return words.slice(0, 2).join(\" \") + \"...\";\n  } else {\n    // For everything else (CJK, numbers, symbols, etc.): take first 5 characters\n    return trimmed.length > 5 ? trimmed.slice(0, 5) + \"...\" : trimmed;\n  }\n}\n\n/**\n * Generate a preview text for thumbnail display (always 1 character)\n * @param content - The full text content\n * @returns string - The first character of the content\n */\nexport function getTextPreview(content: string): string {\n  if (!content) return \"\";\n  const trimmed = content.trim().replace(/\\s+/g, \" \");\n  return trimmed.charAt(0);\n}\n\n/**\n * Load a text file and return an array of TextData (one per line)\n * @param file - The text file to load\n * @returns Promise<TextData[]> - Array of text data, one for each non-empty line\n */\nexport async function loadTextFile(file: File): Promise<TextData[]> {\n  // Quick validation before any heavy operations\n  const maxSize = 1 * 1024 * 1024;\n  if (file.size > maxSize) {\n    throw new Error(\"File too large\");\n  }\n\n  if (file.size === 0) {\n    throw new Error(\"Empty file\");\n  }\n\n  const baseId = await getSha256(file);\n  const content = await file.text();\n\n  const lines = content.split(\"\\n\").filter((line) => line.trim() !== \"\");\n  if (lines.length === 0) {\n    throw new Error(\"No content\");\n  }\n\n  // Limit number of lines to prevent UI freeze\n  const maxLines = 100;\n  if (lines.length > maxLines) {\n    throw new Error(\"Too many lines\");\n  }\n\n  return lines.map((line, index) => {\n    const trimmedContent = line.trim();\n    return {\n      id: `${baseId}-${index}`,\n      name: getTextName(trimmedContent),\n      content: trimmedContent,\n      thumbnailSrc: getTextPreview(trimmedContent),\n    };\n  });\n}\n"],"names":[],"mappings":"AAOA,eAAe,UAAU,MAA6B;AACpD,QAAM,SAAS,MAAM,KAAK,YAAA;AAC1B,QAAM,aAAa,MAAM,OAAO,OAAO,OAAO,WAAW,MAAM;AAC/D,QAAM,YAAY,MAAM,KAAK,IAAI,WAAW,UAAU,CAAC;AACvD,QAAM,UAAU,UACb,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAC1C,KAAK,EAAE;AACV,SAAO;AACT;AAOO,SAAS,YAAY,SAAyB;AACnD,MAAI,CAAC,QAAS,QAAO;AAGrB,QAAM,UAAU,QAAQ,KAAA,EAAO,QAAQ,QAAQ,GAAG;AAGlD,QAAM,YAAY,QAAQ,OAAO,CAAC;AAClC,QAAM,kBAAkB,WAAW,KAAK,SAAS;AAEjD,MAAI,iBAAiB;AAEnB,UAAM,QAAQ,QAAQ,MAAM,GAAG;AAC/B,QAAI,MAAM,UAAU,GAAG;AACrB,aAAO;AAAA,IAAA;AAET,WAAO,MAAM,MAAM,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI;AAAA,EAAA,OAChC;AAEL,WAAO,QAAQ,SAAS,IAAI,QAAQ,MAAM,GAAG,CAAC,IAAI,QAAQ;AAAA,EAAA;AAE9D;AAOO,SAAS,eAAe,SAAyB;AACtD,MAAI,CAAC,QAAS,QAAO;AACrB,QAAM,UAAU,QAAQ,KAAA,EAAO,QAAQ,QAAQ,GAAG;AAClD,SAAO,QAAQ,OAAO,CAAC;AACzB;AAOA,eAAsB,aAAa,MAAiC;AAElE,QAAM,UAAU,IAAI,OAAO;AAC3B,MAAI,KAAK,OAAO,SAAS;AACvB,UAAM,IAAI,MAAM,gBAAgB;AAAA,EAAA;AAGlC,MAAI,KAAK,SAAS,GAAG;AACnB,UAAM,IAAI,MAAM,YAAY;AAAA,EAAA;AAG9B,QAAM,SAAS,MAAM,UAAU,IAAI;AACnC,QAAM,UAAU,MAAM,KAAK,KAAA;AAE3B,QAAM,QAAQ,QAAQ,MAAM,IAAI,EAAE,OAAO,CAAC,SAAS,KAAK,KAAA,MAAW,EAAE;AACrE,MAAI,MAAM,WAAW,GAAG;AACtB,UAAM,IAAI,MAAM,YAAY;AAAA,EAAA;AAI9B,QAAM,WAAW;AACjB,MAAI,MAAM,SAAS,UAAU;AAC3B,UAAM,IAAI,MAAM,gBAAgB;AAAA,EAAA;AAGlC,SAAO,MAAM,IAAI,CAAC,MAAM,UAAU;AAChC,UAAM,iBAAiB,KAAK,KAAA;AAC5B,WAAO;AAAA,MACL,IAAI,GAAG,MAAM,IAAI,KAAK;AAAA,MACtB,MAAM,YAAY,cAAc;AAAA,MAChC,SAAS;AAAA,MACT,cAAc,eAAe,cAAc;AAAA,IAAA;AAAA,EAC7C,CACD;AACH;"}